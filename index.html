<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISO 27001 å°å…¥å°ˆæ¡ˆ WBS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateX(-50px); }
            100% { transform: translateX(50px); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 25px;
            padding: 8px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            transform: scale(1.02);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .search-box input {
            border: none;
            outline: none;
            padding: 8px;
            font-size: 14px;
            width: 250px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .content {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .wbs-tree {
            font-size: 14px;
            line-height: 1.6;
        }

        .wbs-level-1 {
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
            padding-left: 20px;
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.1), transparent);
            border-radius: 0 10px 10px 0;
        }

        .wbs-level-2 {
            margin: 15px 0;
            padding-left: 20px;
            border-left: 3px solid #2ecc71;
            background: linear-gradient(90deg, rgba(46, 204, 113, 0.08), transparent);
        }

        .wbs-level-3 {
            margin: 10px 0;
            padding-left: 20px;
            border-left: 2px solid #f39c12;
            background: linear-gradient(90deg, rgba(243, 156, 18, 0.06), transparent);
        }

        .wbs-level-4 {
            margin: 8px 0;
            padding-left: 20px;
            color: #666;
            border-left: 1px solid #95a5a6;
        }

        .wbs-item {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .wbs-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(5px);
        }

        .wbs-code {
            font-weight: bold;
            color: #2c3e50;
            margin-right: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .wbs-title {
            font-weight: 500;
        }

        .wbs-level-1 .wbs-code {
            color: #3498db;
            font-size: 1.1em;
        }

        .wbs-level-2 .wbs-code {
            color: #2ecc71;
        }

        .wbs-level-3 .wbs-code {
            color: #f39c12;
        }

        .collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: transform 0.3s ease;
            color: #666;
        }

        .collapse-btn.collapsed {
            transform: rotate(-90deg);
        }

        .stats {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            min-width: 200px;
            z-index: 1000;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .stats-label {
            color: #666;
        }

        .stats-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .highlight {
            background: rgba(255, 235, 59, 0.3) !important;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .timeline-view {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .timeline-week {
            font-weight: bold;
            color: #3498db;
            min-width: 80px;
            margin-right: 20px;
        }

        .timeline-content {
            flex: 1;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box input {
                width: 200px;
            }

            .stats {
                position: relative;
                top: auto;
                right: auto;
                margin: 20px auto;
                max-width: 100%;
            }

            .content {
                padding: 20px;
                padding-right: 20px; /* æ‰‹æ©Ÿç‰ˆä½¿ç”¨æ­£å¸¸padding */
                max-height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ISO 27001 å°å…¥å°ˆæ¡ˆ</h1>
            <p class="subtitle">Work Breakdown Structure (WBS) | å°ˆæ¡ˆæœŸç¨‹ï¼š16é€±</p>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœå°‹ WBS é …ç›®...">
                <span>ğŸ”</span>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="expandAll()">å±•é–‹å…¨éƒ¨</button>
                <button class="btn btn-secondary" onclick="collapseAll()">æ”¶åˆå…¨éƒ¨</button>
                <button class="btn btn-success" onclick="toggleTimeline()">æ™‚ç¨‹æª¢è¦–</button>
                <button class="btn btn-primary" onclick="exportData()">åŒ¯å‡ºè³‡æ–™</button>
            </div>
        </div>

        <div class="content">
            <div id="wbsTree" class="wbs-tree">
                <!-- WBS å…§å®¹æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <div id="timelineView" class="timeline-view">
                <h3>å°ˆæ¡ˆæ™‚ç¨‹æª¢è¦–</h3>
                <div id="timelineContent">
                    <!-- æ™‚ç¨‹å…§å®¹æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <div class="stats">
        <div class="stats-item">
            <span class="stats-label">ç¸½å·¥ä½œé …ç›®:</span>
            <span class="stats-value" id="totalItems">-</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">ä¸»è¦éšæ®µ:</span>
            <span class="stats-value" id="mainPhases">-</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">å·¥ä½œåŒ…æ•¸:</span>
            <span class="stats-value" id="workPackages">-</span>
        </div>
        <div class="stats-item">
            <span class="stats-label">å®Œæˆé€²åº¦:</span>
            <span class="stats-value" id="progress">0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 25%"></div>
        </div>
    </div>

    <script>
        // å°ˆæ¡ˆé–‹å§‹æ—¥æœŸè¨­å®š
        const projectStartDate = new Date('2025-08-01');
        
        // è¨ˆç®—æ—¥æœŸçš„è¼”åŠ©å‡½æ•¸  
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('zh-TW', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit' 
            });
        }
        
        function getWeekDates(weekRange) {
            const weekNum = weekRange.match(/Week (\d+)(?:-(\d+))?/);
            if (!weekNum) return { start: '', end: '', duration: 0 };
            
            const startWeek = parseInt(weekNum[1]);
            const endWeek = weekNum[2] ? parseInt(weekNum[2]) : startWeek;
            
            const startDate = addDays(projectStartDate, (startWeek - 1) * 7);
            const endDate = addDays(projectStartDate, endWeek * 7 - 1);
            const duration = (endWeek - startWeek + 1) * 7;
            
            return {
                start: formatDate(startDate),
                end: formatDate(endDate),
                duration: duration
            };
        }

        // WBS è³‡æ–™çµæ§‹
        const wbsData = {
            "1.0": {
                title: "å°ˆæ¡ˆå•Ÿå‹•èˆ‡è¦åŠƒ",
                weeks: "Week 1-2",
                duration: "2é€± (14å¤©)",
                children: {
                    "1.1": {
                        title: "å°ˆæ¡ˆç®¡ç†å»ºç«‹",
                        duration: "3å¤©",
                        children: {
                            "1.1.1": {
                                title: "å°ˆæ¡ˆç« ç¨‹åˆ¶å®š",
                                duration: "0.5å¤©",
                                children: {
                                    "1.1.1.1": { title: "å°ˆæ¡ˆç›®æ¨™å®šç¾©", duration: "2å°æ™‚" },
                                    "1.1.1.2": { title: "æˆåŠŸæ¨™æº–è¨­å®š", duration: "1å°æ™‚" },
                                    "1.1.1.3": { title: "å°ˆæ¡ˆç¯„åœç•Œå®š", duration: "2å°æ™‚" },
                                    "1.1.1.4": { title: "åˆ©å®³é—œä¿‚äººè­˜åˆ¥", duration: "1å°æ™‚" }
                                }
                            },
                            "1.1.2": {
                                title: "å°ˆæ¡ˆè¨ˆç•«åˆ¶å®š",
                                duration: "1å¤©",
                                children: {
                                    "1.1.2.1": { title: "WBSè©³ç´°åˆ†è§£", duration: "3å°æ™‚" },
                                    "1.1.2.2": { title: "æ™‚ç¨‹è¦åŠƒ", duration: "2å°æ™‚" },
                                    "1.1.2.3": { title: "è³‡æºé…ç½®è¨ˆç•«", duration: "2å°æ™‚" },
                                    "1.1.2.4": { title: "é ç®—ç·¨åˆ—", duration: "1å°æ™‚" }
                                }
                            }
                        }
                    },
                    "1.2": {
                        title: "çµ„ç¹”æº–å‚™",
                        duration: "4å¤©",
                        children: {
                            "1.2.1": {
                                title: "ISMSæ¨å‹•çµ„ç¹”å»ºç«‹",
                                duration: "1å¤©",
                                children: {
                                    "1.2.1.1": { title: "æ¨å‹•å°çµ„æˆç«‹", duration: "3å°æ™‚" },
                                    "1.2.1.2": { title: "è§’è‰²è·è²¬å®šç¾©", duration: "3å°æ™‚" },
                                    "1.2.1.3": { title: "æ±ºç­–æ©Ÿåˆ¶å»ºç«‹", duration: "2å°æ™‚" }
                                }
                            },
                            "1.2.2": {
                                title: "äººå“¡æŒ‡æ´¾èˆ‡åŸ¹è¨“",
                                duration: "2å¤©",
                                children: {
                                    "1.2.2.1": { title: "å°ˆæ¡ˆç¶“ç†æŒ‡æ´¾", duration: "2å°æ™‚" },
                                    "1.2.2.2": { title: "æŠ€è¡“è² è²¬äººæŒ‡æ´¾", duration: "2å°æ™‚" },
                                    "1.2.2.3": { title: "æ ¸å¿ƒåœ˜éšŠçµ„å»º", duration: "4å°æ™‚" }
                                }
                            }
                        }
                    },
                    "1.3": {
                        title: "ISMSç¯„ç–‡å®šç¾©",
                        duration: "3å¤©",
                        children: {
                            "1.3.1": {
                                title: "çµ„ç¹”è„ˆçµ¡åˆ†æ",
                                duration: "1å¤©",
                                children: {
                                    "1.3.1.1": { title: "å…§å¤–éƒ¨è­°é¡Œè­˜åˆ¥", duration: "3å°æ™‚" },
                                    "1.3.1.2": { title: "åˆ©å®³é—œä¿‚äººéœ€æ±‚åˆ†æ", duration: "3å°æ™‚" }
                                }
                            },
                            "1.3.2": {
                                title: "ç¯„ç–‡é‚Šç•ŒåŠƒå®š",
                                duration: "1å¤©",
                                children: {
                                    "1.3.2.1": { title: "çµ„ç¹”é‚Šç•Œå®šç¾©", duration: "2å°æ™‚" },
                                    "1.3.2.2": { title: "å¯¦é«”é‚Šç•Œå®šç¾©", duration: "2å°æ™‚" },
                                    "1.3.2.3": { title: "æŠ€è¡“é‚Šç•Œå®šç¾©", duration: "2å°æ™‚" }
                                }
                            }
                        }
                    }
                }
            },
            "2.0": {
                title: "ç¾æ³è©•ä¼°èˆ‡åˆ†æ",
                weeks: "Week 3-4",
                duration: "2é€± (14å¤©)",
                children: {
                    "2.1": {
                        title: "è³‡è¨Šè³‡ç”¢ç›¤é»",
                        duration: "5å¤©",
                        children: {
                            "2.1.1": {
                                title: "è³‡ç”¢æ¸…å†Šå»ºç«‹",
                                duration: "2å¤©",
                                children: {
                                    "2.1.1.1": { title: "ç¡¬é«”è³‡ç”¢ç›¤é»", duration: "4å°æ™‚" },
                                    "2.1.1.2": { title: "è»Ÿé«”è³‡ç”¢ç›¤é»", duration: "4å°æ™‚" },
                                    "2.1.1.3": { title: "è³‡è¨Šè³‡ç”¢ç›¤é»", duration: "4å°æ™‚" }
                                }
                            },
                            "2.1.2": {
                                title: "è³‡ç”¢åˆ†é¡åˆ†ç´š",
                                duration: "2å¤©",
                                children: {
                                    "2.1.2.1": { title: "è³‡ç”¢åˆ†é¡æ¨™æº–åˆ¶å®š", duration: "4å°æ™‚" },
                                    "2.1.2.2": { title: "è³‡ç”¢é‡è¦æ€§è©•ä¼°", duration: "4å°æ™‚" }
                                }
                            }
                        }
                    },
                    "2.2": {
                        title: "ç¾è¡Œæ§åˆ¶æªæ–½è©•ä¼°",
                        duration: "6å¤©",
                        children: {
                            "2.2.1": {
                                title: "æŠ€è¡“æ§åˆ¶æªæ–½æª¢è¦–",
                                duration: "2å¤©",
                                children: {
                                    "2.2.1.1": { title: "ç¶²è·¯å®‰å…¨æ§åˆ¶", duration: "4å°æ™‚" },
                                    "2.2.1.2": { title: "ç³»çµ±å®‰å…¨æ§åˆ¶", duration: "4å°æ™‚" }
                                }
                            },
                            "2.2.2": {
                                title: "ç®¡ç†æ§åˆ¶æªæ–½æª¢è¦–",
                                duration: "2å¤©",
                                children: {
                                    "2.2.2.1": { title: "æ”¿ç­–åˆ¶åº¦æª¢è¦–", duration: "6å°æ™‚" },
                                    "2.2.2.2": { title: "ç¨‹åºæ–‡ä»¶æª¢è¦–", duration: "6å°æ™‚" }
                                }
                            }
                        }
                    }
                }
            },
            "3.0": {
                title: "é¢¨éšªè©•ä¼°èˆ‡è™•ç†",
                weeks: "Week 5-6",
                duration: "2é€± (14å¤©)",
                children: {
                    "3.1": {
                        title: "é¢¨éšªè©•ä¼°æº–å‚™",
                        duration: "2å¤©",
                        children: {
                            "3.1.1": {
                                title: "é¢¨éšªè©•ä¼°æ–¹æ³•é¸å®š",
                                duration: "1å¤©",
                                children: {
                                    "3.1.1.1": { title: "è©•ä¼°æ–¹æ³•ç ”æ", duration: "3å°æ™‚" },
                                    "3.1.1.2": { title: "è©•ä¼°å·¥å…·é¸æ“‡", duration: "3å°æ™‚" }
                                }
                            }
                        }
                    },
                    "3.2": {
                        title: "é¢¨éšªè­˜åˆ¥èˆ‡åˆ†æ",
                        duration: "6å¤©",
                        children: {
                            "3.2.1": {
                                title: "å¨è„…è­˜åˆ¥",
                                duration: "2å¤©",
                                children: {
                                    "3.2.1.1": { title: "å…§éƒ¨å¨è„…åˆ†æ", duration: "6å°æ™‚" },
                                    "3.2.1.2": { title: "å¤–éƒ¨å¨è„…åˆ†æ", duration: "6å°æ™‚" }
                                }
                            },
                            "3.2.2": {
                                title: "å¼±é»è­˜åˆ¥",
                                duration: "2å¤©",
                                children: {
                                    "3.2.2.1": { title: "æŠ€è¡“å¼±é»æƒæ", duration: "8å°æ™‚" },
                                    "3.2.2.2": { title: "ç®¡ç†å¼±é»åˆ†æ", duration: "8å°æ™‚" }
                                }
                            }
                        }
                    },
                    "3.3": {
                        title: "é©ç”¨æ€§è²æ˜æ›¸åˆ¶å®š",
                        duration: "4å¤©",
                        children: {
                            "3.3.1": {
                                title: "æ§åˆ¶æªæ–½é¸æ“‡",
                                duration: "2å¤©",
                                children: {
                                    "3.3.1.1": { title: "ISO 27001é™„éŒ„Aåˆ†æ", duration: "8å°æ™‚" },
                                    "3.3.1.2": { title: "é©ç”¨æ§åˆ¶æªæ–½é¸å®š", duration: "8å°æ™‚" }
                                }
                            }
                        }
                    }
                }
            },
            "4.0": {
                title: "æ§åˆ¶æªæ–½è¦åŠƒèˆ‡è¨­è¨ˆ",
                weeks: "Week 7-8",
                duration: "2é€± (14å¤©)",
                children: {
                    "4.1": {
                        title: "è³‡è¨Šå®‰å…¨æ”¿ç­–åˆ¶å®š",
                        duration: "5å¤©",
                        children: {
                            "4.1.1": {
                                title: "æ ¸å¿ƒæ”¿ç­–åˆ¶å®š",
                                duration: "3å¤©",
                                children: {
                                    "4.1.1.1": { title: "è³‡è¨Šå®‰å…¨æ”¿ç­–", duration: "8å°æ™‚" },
                                    "4.1.1.2": { title: "å­˜å–æ§åˆ¶æ”¿ç­–", duration: "8å°æ™‚" }
                                }
                            }
                        }
                    },
                    "4.2": {
                        title: "æŠ€è¡“æ§åˆ¶æªæ–½è¨­è¨ˆ",
                        duration: "7å¤©",
                        children: {
                            "4.2.1": {
                                title: "å­˜å–æ§åˆ¶è¨­è¨ˆ",
                                duration: "3å¤©",
                                children: {
                                    "4.2.1.1": { title: "èº«åˆ†èªè­‰æ©Ÿåˆ¶", duration: "8å°æ™‚" },
                                    "4.2.1.2": { title: "æˆæ¬Šç®¡ç†æ©Ÿåˆ¶", duration: "8å°æ™‚" }
                                }
                            },
                            "4.2.2": {
                                title: "ç¶²è·¯å®‰å…¨è¨­è¨ˆ",
                                duration: "2å¤©",
                                children: {
                                    "4.2.2.1": { title: "ç¶²è·¯åˆ†æ®µè¨­è¨ˆ", duration: "8å°æ™‚" },
                                    "4.2.2.2": { title: "é˜²ç«ç‰†æ”¿ç­–è¨­è¨ˆ", duration: "8å°æ™‚" }
                                }
                            }
                        }
                    }
                }
            },
            "5.0": {
                title: "å¯¦æ–½èˆ‡éƒ¨ç½²",
                weeks: "Week 9-12",
                duration: "4é€± (28å¤©)",
                children: {
                    "5.1": {
                        title: "æŠ€è¡“æ§åˆ¶æªæ–½å¯¦æ–½",
                        duration: "14å¤©",
                        children: {
                            "5.1.1": {
                                title: "ç¶²è·¯å®‰å…¨å¼·åŒ–",
                                duration: "5å¤©",
                                children: {
                                    "5.1.1.1": { title: "é˜²ç«ç‰†è¦å‰‡å„ªåŒ–", duration: "2å¤©" },
                                    "5.1.1.2": { title: "å…¥ä¾µåµæ¸¬ç³»çµ±éƒ¨ç½²", duration: "2å¤©" }
                                }
                            },
                            "5.1.2": {
                                title: "ç³»çµ±å®‰å…¨å¼·åŒ–",
                                duration: "5å¤©",
                                children: {
                                    "5.1.2.1": { title: "ç³»çµ±å¼·åŒ–è¨­å®š", duration: "2å¤©" },
                                    "5.1.2.2": { title: "é˜²æ¯’è»Ÿé«”éƒ¨ç½²", duration: "1å¤©" }
                                }
                            }
                        }
                    },
                    "5.2": {
                        title: "ç®¡ç†æ§åˆ¶æªæ–½å¯¦æ–½",
                        duration: "8å¤©",
                        children: {
                            "5.2.1": {
                                title: "æ”¿ç­–ç¨‹åºç™¼å¸ƒ",
                                duration: "3å¤©",
                                children: {
                                    "5.2.1.1": { title: "æ”¿ç­–æ­£å¼ç™¼å¸ƒ", duration: "1å¤©" },
                                    "5.2.1.2": { title: "ç¨‹åºæ“ä½œæ‰‹å†Š", duration: "2å¤©" }
                                }
                            },
                            "5.2.2": {
                                title: "æ•™è‚²è¨“ç·´åŸ·è¡Œ",
                                duration: "3å¤©",
                                children: {
                                    "5.2.2.1": { title: "é«˜éšä¸»ç®¡è¨“ç·´", duration: "0.5å¤©" },
                                    "5.2.2.2": { title: "ä¸€èˆ¬å“¡å·¥è¨“ç·´", duration: "1.5å¤©" }
                                }
                            }
                        }
                    }
                }
            },
            "6.0": {
                title: "ç›£æ§èˆ‡é‡æ¸¬",
                weeks: "Week 13-14",
                duration: "2é€± (14å¤©)",
                children: {
                    "6.1": {
                        title: "ç›£æ§æ©Ÿåˆ¶å»ºç«‹",
                        duration: "8å¤©",
                        children: {
                            "6.1.1": {
                                title: "æŠ€è¡“ç›£æ§æ©Ÿåˆ¶",
                                duration: "5å¤©",
                                children: {
                                    "6.1.1.1": { title: "SIEMç³»çµ±éƒ¨ç½²", duration: "2å¤©" },
                                    "6.1.1.2": { title: "å®‰å…¨äº‹ä»¶ç›£æ§", duration: "2å¤©" }
                                }
                            }
                        }
                    },
                    "6.2": {
                        title: "è©¦é‹è¡Œèˆ‡æ¸¬è©¦",
                        duration: "6å¤©",
                        children: {
                            "6.2.1": {
                                title: "æ§åˆ¶æªæ–½æ¸¬è©¦",
                                duration: "3å¤©",
                                children: {
                                    "6.2.1.1": { title: "æŠ€è¡“æ§åˆ¶æ¸¬è©¦", duration: "1å¤©" },
                                    "6.2.1.2": { title: "ç®¡ç†æ§åˆ¶æ¸¬è©¦", duration: "1å¤©" }
                                }
                            }
                        }
                    }
                }
            },
            "7.0": {
                title: "å…§éƒ¨ç¨½æ ¸",
                weeks: "Week 15",
                duration: "1é€± (7å¤©)",
                children: {
                    "7.1": {
                        title: "å…§ç¨½æº–å‚™",
                        duration: "2å¤©",
                        children: {
                            "7.1.1": {
                                title: "ç¨½æ ¸è¨ˆç•«åˆ¶å®š",
                                duration: "1å¤©",
                                children: {
                                    "7.1.1.1": { title: "ç¨½æ ¸ç¯„åœå®šç¾©", duration: "4å°æ™‚" },
                                    "7.1.1.2": { title: "ç¨½æ ¸æ™‚ç¨‹å®‰æ’", duration: "4å°æ™‚" }
                                }
                            }
                        }
                    },
                    "7.2": {
                        title: "å…§ç¨½åŸ·è¡Œ",
                        duration: "3å¤©",
                        children: {
                            "7.2.1": {
                                title: "æ–‡ä»¶å¯©æŸ¥",
                                duration: "1å¤©",
                                children: {
                                    "7.2.1.1": { title: "æ”¿ç­–æ–‡ä»¶å¯©æŸ¥", duration: "4å°æ™‚" },
                                    "7.2.1.2": { title: "ç¨‹åºæ–‡ä»¶å¯©æŸ¥", duration: "4å°æ™‚" }
                                }
                            }
                        }
                    },
                    "7.3": {
                        title: "å…§ç¨½å ±å‘Š",
                        duration: "2å¤©",
                        children: {
                            "7.3.1": {
                                title: "ç¨½æ ¸å ±å‘Šæ’°å¯«",
                                duration: "1å¤©",
                                children: {
                                    "7.3.1.1": { title: "ç™¼ç¾äº‹é …æ•´ç†", duration: "4å°æ™‚" },
                                    "7.3.1.2": { title: "å ±å‘Šæ›¸æ’°å¯«", duration: "4å°æ™‚" }
                                }
                            }
                        }
                    }
                }
            },
            "8.0": {
                title: "ç®¡ç†å¯©æŸ¥èˆ‡é©—è­‰æº–å‚™",
                weeks: "Week 16",
                duration: "1é€± (7å¤©)",
                children: {
                    "8.1": {
                        title: "ç®¡ç†å¯©æŸ¥åŸ·è¡Œ",
                        duration: "3å¤©",
                        children: {
                            "8.1.1": {
                                title: "ç®¡å¯©è³‡æ–™æº–å‚™",
                                duration: "2å¤©",
                                children: {
                                    "8.1.1.1": { title: "ç¸¾æ•ˆå ±å‘Šå½™æ•´", duration: "4å°æ™‚" },
                                    "8.1.1.2": { title: "æ”¹å–„å»ºè­°æ•´ç†", duration: "4å°æ™‚" }
                                }
                            }
                        }
                    },
                    "8.2": {
                        title: "ç¬¬ä¸‰æ–¹é©—è­‰æº–å‚™",
                        duration: "4å¤©",
                        children: {
                            "8.2.1": {
                                title: "é©—è­‰æ–‡ä»¶æº–å‚™",
                                duration: "2å¤©",
                                children: {
                                    "8.2.1.1": { title: "æ–‡ä»¶å®Œæ•´æ€§æª¢æŸ¥", duration: "8å°æ™‚" },
                                    "8.2.1.2": { title: "è­‰æ“šè³‡æ–™æ•´ç†", duration: "8å°æ™‚" }
                                }
                            }
                        }
                    }
                }
            }
        };

        // å±•é–‹/æ”¶åˆåŠŸèƒ½
        function toggleCollapse(btn) {
            const isCollapsed = btn.classList.contains('collapsed');
            const parentItem = btn.closest('.wbs-level-1, .wbs-level-2, .wbs-level-3');
            const childContainer = parentItem.querySelector('.wbs-children');
            
            if (childContainer) {
                if (isCollapsed) {
                    btn.classList.remove('collapsed');
                    btn.textContent = 'â–¼';
                    childContainer.style.display = 'block';
                } else {
                    btn.classList.add('collapsed');
                    btn.textContent = 'â–¶';
                    childContainer.style.display = 'none';
                }
            }
        }

        // å±•é–‹å…¨éƒ¨
        function expandAll() {
            const buttons = document.querySelectorAll('.collapse-btn');
            buttons.forEach(btn => {
                btn.classList.remove('collapsed');
                btn.textContent = 'â–¼';
                const parentItem = btn.closest('.wbs-level-1, .wbs-level-2, .wbs-level-3');
                const childContainer = parentItem ? parentItem.querySelector('.wbs-children') : null;
                if (childContainer) {
                    childContainer.style.display = 'block';
                }
            });
        }

        // æ”¶åˆå…¨éƒ¨
        function collapseAll() {
            const buttons = document.querySelectorAll('.collapse-btn');
            buttons.forEach(btn => {
                btn.classList.add('collapsed');
                btn.textContent = 'â–¶';
                const parentItem = btn.closest('.wbs-level-1, .wbs-level-2, .wbs-level-3');
                const childContainer = parentItem ? parentItem.querySelector('.wbs-children') : null;
                if (childContainer) {
                    childContainer.style.display = 'none';
                }
            });
        }

        // æ™‚ç¨‹æª¢è¦–åˆ‡æ›
        function toggleTimeline() {
            const wbsTree = document.getElementById('wbsTree');
            const timelineView = document.getElementById('timelineView');
            
            if (timelineView.style.display === 'none' || timelineView.style.display === '') {
                wbsTree.style.display = 'none';
                timelineView.style.display = 'block';
                renderTimeline();
            } else {
                wbsTree.style.display = 'block';
                timelineView.style.display = 'none';
            }
        }

        // åŒ¯å‡ºè³‡æ–™åŠŸèƒ½
        function exportData() {
            let exportText = 'ISO 27001 å°å…¥å°ˆæ¡ˆ WBS\n';
            exportText += '='.repeat(50) + '\n';
            exportText += 'å°ˆæ¡ˆæœŸé–“ï¼š' + formatDate(projectStartDate) + ' ~ ' + formatDate(addDays(projectStartDate, 112)) + '\n';
            exportText += 'ç¸½å·¥æœŸï¼š112å¤© (16é€±)\n\n';
            
            function exportLevel(data, level) {
                level = level || 0;
                const indent = '  '.repeat(level);
                Object.keys(data).forEach(key => {
                    const item = data[key];
                    if (typeof item === 'object' && item.title) {
                        let line = indent + key + ' ' + item.title;
                        if (item.duration) {
                            line += ' [' + item.duration + ']';
                        }
                        if (item.weeks) {
                            const dateInfo = getWeekDates(item.weeks);
                            line += ' (' + dateInfo.start + ' ~ ' + dateInfo.end + ')';
                        }
                        exportText += line + '\n';
                        if (item.children) {
                            exportLevel(item.children, level + 1);
                        }
                    }
                });
            }
            
            exportLevel(wbsData);
            
            // å‰µå»ºä¸‹è¼‰é€£çµ
            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ISO27001_WBS_' + new Date().toISOString().slice(0,10) + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // å‰µå»º WBS å…ƒç´ 
        function createWBSElement(code, item, level) {
            const div = document.createElement('div');
            div.className = 'wbs-level-' + level;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'wbs-item';
            itemDiv.dataset.code = code;
            
            let html = '';
            
            // å¦‚æœæœ‰å­é …ç›®ï¼Œæ·»åŠ å±•é–‹/æ”¶åˆæŒ‰éˆ•
            if (item.children) {
                html += '<button class="collapse-btn" onclick="toggleCollapse(this)">â–¼</button>';
            }
            
            html += '<span class="wbs-code">' + code + '</span>';
            html += '<span class="wbs-title">' + item.title + '</span>';
            
            // æ·»åŠ æ™‚ç¨‹å’Œæ—¥æœŸè³‡è¨Š
            if (item.weeks) {
                const dateInfo = getWeekDates(item.weeks);
                html += ' <span style="color: #666; font-size: 0.85em; margin-left: 10px;">(' + item.weeks + ' | ' + item.duration + ' | ' + dateInfo.start + ' ~ ' + dateInfo.end + ')</span>';
            } else if (item.duration) {
                html += ' <span style="color: #888; font-size: 0.8em; margin-left: 10px;">[' + item.duration + ']</span>';
            }
            
            itemDiv.innerHTML = html;
            div.appendChild(itemDiv);
            
            // æ·»åŠ å­é …ç›®
            if (item.children) {
                const childContainer = document.createElement('div');
                childContainer.className = 'wbs-children';
                
                Object.keys(item.children).forEach(childKey => {
                    const childItem = item.children[childKey];
                    let childElement;
                    
                    if (typeof childItem === 'object' && childItem.title) {
                        // æœ‰ title å±¬æ€§çš„ç‰©ä»¶
                        childElement = createWBSElement(childKey, childItem, level + 1);
                    }
                    
                    if (childElement) {
                        childContainer.appendChild(childElement);
                    }
                });
                
                div.appendChild(childContainer);
            }
            
            return div;
        }

        // æ¸²æŸ“ WBS æ¨¹ç‹€çµæ§‹
        function renderWBS() {
            const container = document.getElementById('wbsTree');
            container.innerHTML = '';
            
            Object.keys(wbsData).forEach(key => {
                const item = wbsData[key];
                const element = createWBSElement(key, item, 1);
                container.appendChild(element);
            });
        }

        // æ¸²æŸ“æ™‚ç¨‹æª¢è¦–
        function renderTimeline() {
            const container = document.getElementById('timelineContent');
            
            const timelineData = [
                { 
                    week: "Week 1-2", 
                    phase: "å°ˆæ¡ˆå•Ÿå‹•èˆ‡è¦åŠƒ", 
                    duration: "14å¤©",
                    startDate: "2025/08/01",
                    endDate: "2025/08/14",
                    tasks: ["å°ˆæ¡ˆç« ç¨‹åˆ¶å®š (0.5å¤©)", "ISMSæ¨å‹•çµ„ç¹”å»ºç«‹ (1å¤©)", "ç¯„ç–‡é‚Šç•ŒåŠƒå®š (1å¤©)"],
                    totalDays: 10
                },
                { 
                    week: "Week 3-4", 
                    phase: "ç¾æ³è©•ä¼°èˆ‡åˆ†æ", 
                    duration: "14å¤©",
                    startDate: "2025/08/15",
                    endDate: "2025/08/28",
                    tasks: ["è³‡è¨Šè³‡ç”¢ç›¤é» (5å¤©)", "ç¾è¡Œæ§åˆ¶æªæ–½è©•ä¼° (6å¤©)", "æ³•è¦éµå¾ªè©•ä¼° (3å¤©)"],
                    totalDays: 14
                },
                { 
                    week: "Week 5-6", 
                    phase: "é¢¨éšªè©•ä¼°èˆ‡è™•ç†", 
                    duration: "14å¤©",
                    startDate: "2025/08/29",
                    endDate: "2025/09/11",
                    tasks: ["é¢¨éšªè©•ä¼°æº–å‚™ (2å¤©)", "é¢¨éšªè­˜åˆ¥èˆ‡åˆ†æ (6å¤©)", "é©ç”¨æ€§è²æ˜æ›¸åˆ¶å®š (4å¤©)"],
                    totalDays: 12
                },
                { 
                    week: "Week 7-8", 
                    phase: "æ§åˆ¶æªæ–½è¦åŠƒèˆ‡è¨­è¨ˆ", 
                    duration: "14å¤©",
                    startDate: "2025/09/12",
                    endDate: "2025/09/25",
                    tasks: ["è³‡è¨Šå®‰å…¨æ”¿ç­–åˆ¶å®š (5å¤©)", "æŠ€è¡“æ§åˆ¶æªæ–½è¨­è¨ˆ (7å¤©)", "ç®¡ç†ç¨‹åºå»ºç«‹ (2å¤©)"],
                    totalDays: 12
                },
                { 
                    week: "Week 9-12", 
                    phase: "å¯¦æ–½èˆ‡éƒ¨ç½²", 
                    duration: "28å¤©",
                    startDate: "2025/09/26",
                    endDate: "2025/10/23",
                    tasks: ["æŠ€è¡“æ§åˆ¶æªæ–½å¯¦æ–½ (14å¤©)", "ç®¡ç†æ§åˆ¶æªæ–½å¯¦æ–½ (8å¤©)", "å¯¦é«”æ§åˆ¶æªæ–½å¯¦æ–½ (6å¤©)"],
                    totalDays: 28
                },
                { 
                    week: "Week 13-14", 
                    phase: "ç›£æ§èˆ‡é‡æ¸¬", 
                    duration: "14å¤©",
                    startDate: "2025/10/24",
                    endDate: "2025/11/06",
                    tasks: ["ç›£æ§æ©Ÿåˆ¶å»ºç«‹ (8å¤©)", "è©¦é‹è¡Œèˆ‡æ¸¬è©¦ (6å¤©)", "KPIæŒ‡æ¨™å»ºç«‹ (ä¸¦è¡Œ)"],
                    totalDays: 14
                },
                { 
                    week: "Week 15", 
                    phase: "å…§éƒ¨ç¨½æ ¸", 
                    duration: "7å¤©",
                    startDate: "2025/11/07",
                    endDate: "2025/11/13",
                    tasks: ["å…§ç¨½æº–å‚™ (2å¤©)", "å…§ç¨½åŸ·è¡Œ (3å¤©)", "å…§ç¨½å ±å‘Š (2å¤©)"],
                    totalDays: 7
                },
                { 
                    week: "Week 16", 
                    phase: "ç®¡ç†å¯©æŸ¥èˆ‡é©—è­‰æº–å‚™", 
                    duration: "7å¤©",
                    startDate: "2025/11/14",
                    endDate: "2025/11/20",
                    tasks: ["ç®¡ç†å¯©æŸ¥åŸ·è¡Œ (3å¤©)", "ç¬¬ä¸‰æ–¹é©—è­‰æº–å‚™ (4å¤©)", "æ–‡ä»¶æœ€çµ‚æª¢æŸ¥ (ä¸¦è¡Œ)"],
                    totalDays: 7
                }
            ];
            
            container.innerHTML = '<div style="margin-bottom: 20px;"><h4>å°ˆæ¡ˆç¸½è¦½</h4><div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;"><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;"><div><strong>å°ˆæ¡ˆé–‹å§‹ï¼š</strong>' + formatDate(projectStartDate) + '</div><div><strong>é è¨ˆå®Œæˆï¼š</strong>' + formatDate(addDays(projectStartDate, 112)) + '</div><div><strong>ç¸½å·¥æœŸï¼š</strong>112å¤© (16é€±)</div><div><strong>å·¥ä½œå¤©ï¼š</strong>ç´„80å¤©</div></div></div></div>';
            
            timelineData.forEach(item => {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                
                const progressWidth = Math.min((item.totalDays / 28) * 100, 100);
                
                timelineItem.innerHTML = '<div class="timeline-week">' + item.week + '</div><div class="timeline-content"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><h4 style="margin: 0; color: #2c3e50;">' + item.phase + '</h4><span style="color: #666; font-size: 0.9em; font-weight: bold;">' + item.duration + '</span></div><div style="font-size: 0.85em; color: #666; margin-bottom: 10px;">ğŸ“… ' + item.startDate + ' ~ ' + item.endDate + ' | â±ï¸ ' + item.totalDays + 'å¤©</div><ul style="margin: 10px 0; padding-left: 20px;">' + item.tasks.map(task => '<li style="margin-bottom: 5px;">' + task + '</li>').join('') + '</ul><div style="background: #ecf0f1; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 10px;"><div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: ' + progressWidth + '%; border-radius: 4px; transition: width 0.3s ease;"></div></div></div>';
                
                container.appendChild(timelineItem);
            });
        }

        // æ›´æ–°çµ±è¨ˆè³‡è¨Š
        function updateStats() {
            let totalItems = 0;
            let mainPhases = 0;
            let workPackages = 0;
            
            function countItems(data, level) {
                level = level || 1;
                Object.keys(data).forEach(key => {
                    const item = data[key];
                    totalItems++;
                    
                    if (level === 1) {
                        mainPhases++;
                    } else if (level === 2) {
                        workPackages++;
                    }
                    
                    if (item.children) {
                        countItems(item.children, level + 1);
                    }
                });
            }
            
            countItems(wbsData);
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('mainPhases').textContent = mainPhases;
            document.getElementById('workPackages').textContent = workPackages;
        }

        // æœå°‹åŠŸèƒ½
        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                searchWBS(searchTerm);
            });
        }

        function searchWBS(searchTerm) {
            const allItems = document.querySelectorAll('.wbs-item');
            allItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (searchTerm === '' || text.includes(searchTerm)) {
                    item.classList.remove('highlight');
                    if (searchTerm !== '' && text.includes(searchTerm)) {
                        item.classList.add('highlight');
                    }
                    item.style.display = 'block';
                } else {
                    item.classList.remove('highlight');
                }
            });
        }

        // æ›´æ–°å°ˆæ¡ˆæ—¥æœŸè³‡è¨Š
        function updateProjectDates() {
            const projectEndDate = addDays(projectStartDate, 16 * 7 - 1);
            document.querySelector('.subtitle').innerHTML = 'Work Breakdown Structure (WBS) | å°ˆæ¡ˆæœŸç¨‹ï¼š16é€±<br><small style="font-size: 0.9em; opacity: 0.8;">å°ˆæ¡ˆæœŸé–“ï¼š' + formatDate(projectStartDate) + ' ~ ' + formatDate(projectEndDate) + ' | ç¸½å·¥æœŸï¼š112å¤©</small>';
        }

        // åˆå§‹åŒ–é é¢
        function initializePage() {
            renderWBS();
            updateStats();
            setupEventListeners();
            updateProjectDates();
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
